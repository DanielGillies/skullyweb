{{> header title="SKULLY Dealers" cssfile="
<link href='https://api.mapbox.com/mapbox.js/v2.2.2/mapbox.css' rel='stylesheet' />"}}
<div class="nav-container">
    {{> navbar}}
    <!-- ACTUAL PAGE CONTENT -->
    <div class="main-container">
        <section class="bg-dark">
            <div class="container">
                <row>
                    <div class="col-sm-8 col-sm-offset-2">
                        <div class="text-center">
                            <h2 class="mb24">Locate a Dealer</h2>
                            <h4>We’re excited to have a growing dealer network. Once all pre-orders are fulfilled in the summer of 2016, our dealers will have the
                <span class="ar1font">AR-
                  <span class="skullyred">1</span>
                </span> onsite to either try or buy. Do you have a favorite dealer? Let us know on any of our social media channels and we’ll reach out to them.</h4>
                        </div>
                    </div>
                </row>
            </div>
        </section>
        <section class="bg-dark pt0 pb0">
            <div class="container">
                <div class="row">
                    <div class="col-md-12 col-md-offset-0 col-sm-8 col-sm-offset-2">
                        <div id='map'>
                            <a href='#' id='geolocate' class='btn btn-filled ui-button'>Find Stores Near Me</a>
                        </div>
                    </div>
                </div>
            </div>
        </section>
        <section class="bg-dark">
            <div class="container">
                <row>
                    <div class="col-sm-8 col-sm-offset-2">
                        <div class="text-center">
                            <h2 class="mb24">Become a Dealer</h2>
                            <h4>We’re actively looking for qualified dealers to help us expand our reach and deliver the smartest, safest motorcycle helmet on the market to new customers. Interested? Start the process by
                filling out and submitting the form below. </h4>
                            <h3 id="Confirmation">Thank You For Your Application</h2>
            </div>


            <script type="text/javascript">
              var submitted = false;
            </script>
            <iframe name="hidden_iframe" id="hidden_iframe" style="display:none;" onload="if(submitted) {$('#dealerForm').css('display', 'none');$('#Confirmation').css('display', 'inline');}"></iframe>
            <form action="https://docs.google.com/forms/d/1E4CxlQsYsYSY6wcFOR-vnIRNB-rz-wayc_rIdRx-mzI/formResponse" id="dealerForm" method="post" target="hidden_iframe" onsubmit="submitted=true;">
              <div class="ss-form-question errorbox-good" role="listitem">
                <div dir="auto" class="ss-item ss-item-required ss-text">
                  <div class="ss-form-entry">
                    <label class="ss-q-item-label" for="entry_641517159">
                      <div class="ss-q-title">Full Name
                        <label for="itemView.getDomIdToLabel()" aria-label="(Required field)"></label>
                        <span class="ss-required-asterisk" aria-hidden="true">*</span>
                      </div>
                      <div class="ss-q-help ss-secondary-text" dir="auto"></div>
                    </label>
                    <input type="text" name="entry.641517159" value="" class="ss-q-short" id="entry_641517159" dir="auto" aria-label="Full Name  " aria-required="true" required="" title="">

                  </div>
                </div>
              </div>
              <div class="ss-form-question errorbox-good" role="listitem">
                <div dir="auto" class="ss-item ss-item-required ss-text">
                  <div class="ss-form-entry">
                    <label class="ss-q-item-label" for="entry_1275151162">
                      <div class="ss-q-title">Title
                        <label for="itemView.getDomIdToLabel()" aria-label="(Required field)"></label>
                        <span class="ss-required-asterisk" aria-hidden="true">*</span>
                      </div>
                      <div class="gray ss-q-help ss-secondary-text" dir="auto">Parts Manager, Owner, etc.</div>
                    </label>
                    <input type="text" name="entry.1275151162" value="" class="ss-q-short" id="entry_1275151162" dir="auto" aria-label="Title Parts Manager, Owner, etc. " aria-required="true" required="" title="">

                  </div>
                </div>
              </div>
              <div class="ss-form-question errorbox-good" role="listitem">
                <div dir="auto" class="ss-item ss-item-required ss-text">
                  <div class="ss-form-entry">
                    <label class="ss-q-item-label" for="entry_1224868800">
                      <div class="ss-q-title">Email
                        <label for="itemView.getDomIdToLabel()" aria-label="(Required field)"></label>
                        <span class="ss-required-asterisk" aria-hidden="true">*</span>
                      </div>
                      <div class="ss-q-help ss-secondary-text" dir="auto"></div>
                    </label>
                    <input type="text" name="entry.1224868800" value="" class="ss-q-short" id="entry_1224868800" dir="auto" aria-label="Email  " aria-required="true" required="" title="">

                  </div>
                </div>
              </div>
              <div class="ss-form-question errorbox-good" role="listitem">
                <div dir="auto" class="ss-item ss-item-required ss-text">
                  <div class="ss-form-entry">
                    <label class="ss-q-item-label" for="entry_847186761">
                      <div class="ss-q-title">Phone Number
                        <label for="itemView.getDomIdToLabel()" aria-label="(Required field)"></label>
                        <span class="ss-required-asterisk" aria-hidden="true">*</span>
                      </div>
                      <div class="ss-q-help ss-secondary-text" dir="auto"></div>
                    </label>
                    <input type="text" name="entry.847186761" value="" class="ss-q-short" id="entry_847186761" dir="auto" aria-label="Phone Number  Please Enter A Valid Phone Number" aria-required="true" required="" pattern="\+?\(?\d{2,4}\)?[\d\s-]{3,}"
                    title="Please Enter A Valid Phone Number">

                  </div>
                </div>
              </div>
              <div class="ss-form-question errorbox-good" role="listitem">
                <div dir="auto" class="ss-item  ss-paragraph-text">
                  <div class="ss-form-entry">
                    <label class="ss-q-item-label" for="entry_998186053">
                      <div class="ss-q-title">Dealership Name
                      </div>
                      <div class="ss-q-help ss-secondary-text" dir="auto"></div>
                    </label>
                    <textarea name="entry.998186053" rows="8" cols="0" class="ss-q-long" id="entry_998186053" dir="auto" aria-label="Dealership Name  "></textarea>

                  </div>
                </div>
              </div>
              <div class="ss-form-question errorbox-good" role="listitem">
                <div dir="auto" class="ss-item  ss-paragraph-text">
                  <div class="ss-form-entry">
                    <label class="ss-q-item-label" for="entry_1013448113">
                      <div class="ss-q-title">Dealership Address
                      </div>
                      <div class="ss-q-help ss-secondary-text" dir="auto"></div>
                    </label>
                    <textarea name="entry.1013448113" rows="8" cols="0" class="ss-q-long" id="entry_1013448113" dir="auto" aria-label="Dealership Address  "></textarea>

                  </div>
                </div>
              </div>
              <div class="ss-form-question errorbox-good" role="listitem">
                <div dir="auto" class="ss-item  ss-text">
                  <div class="ss-form-entry">
                    <label class="ss-q-item-label" for="entry_1080569748">
                      <div class="ss-q-title">Dealership Website
                      </div>
                      <div class="ss-q-help ss-secondary-text" dir="auto"></div>
                    </label>
                    <input type="text" name="entry.1080569748" value="" class="ss-q-short" id="entry_1080569748" dir="auto" aria-label="Dealership Website  " title="">

                  </div>
                </div>
              </div>
              <div class="ss-form-question errorbox-good" role="listitem">
                <div dir="auto" class="ss-item  ss-text">
                  <div class="ss-form-entry">
                    <label class="ss-q-item-label" for="entry_1610444808">
                      <div class="ss-q-title">Number of Locations
                      </div>
                      <div class="ss-q-help ss-secondary-text" dir="auto"></div>
                    </label>
                    <input type="text" name="entry.1610444808" value="" class="ss-q-short" id="entry_1610444808" dir="auto" aria-label="Number of Locations  " title="">

                  </div>
                </div>
              </div>
              <div class="ss-form-question errorbox-good" role="listitem">
                <div dir="auto" class="ss-item  ss-paragraph-text">
                  <div class="ss-form-entry">
                    <label class="ss-q-item-label" for="entry_1358372626">
                      <div class="ss-q-title">List of Helmet Brands Carried:
                      </div>
                      <div class="ss-q-help ss-secondary-text" dir="auto"></div>
                    </label>
                    <textarea name="entry.1358372626" rows="8" cols="0" class="ss-q-long" id="entry_1358372626" dir="auto" aria-label="List of Helmet Brands Carried:  "></textarea>

                  </div>
                </div>
              </div>
              <div class="ss-form-question errorbox-good" role="listitem">
                <div dir="auto" class="ss-item  ss-paragraph-text">
                  <div class="ss-form-entry">
                    <label class="ss-q-item-label" for="entry_400816578">
                      <div class="ss-q-title">List of Motorcycle Brands Carried:
                      </div>
                      <div class="ss-q-help ss-secondary-text" dir="auto"></div>
                    </label>
                    <textarea name="entry.400816578" rows="8" cols="0" class="ss-q-long" id="entry_400816578" dir="auto" aria-label="List of Motorcycle Brands Carried:  "></textarea>

                  </div>
                </div>
              </div>
              <input type="hidden" name="draftResponse" value="[,,&quot;3186125364139594679&quot;]
">
              <input type="hidden" name="pageHistory" value="0">

              <input type="hidden" name="fvv" value="0">


              <input type="hidden" name="fbzx" value="3186125364139594679">

              <div class="ss-item ss-navigate">
                <table id="navigation-table">
                  <tbody>
                    <tr>
                      <td class="ss-form-entry goog-inline-block" id="navigation-buttons" dir="ltr">
                        <input type="submit" name="submit" value="Submit" id="ss-submit" class="jfk-button jfk-button-action ">
                        <div class="ss-password-warning ss-secondary-text">Never submit passwords through Google Forms.</div>
                      </td>
                    </tr>
                  </tbody>
                </table>
              </div>
              </ol>
            </form>

          </div>
        </row>
      </div>
    </section>
    {{> footer}}
  </div>
  {{> scripts}}
  <script src='https://api.mapbox.com/mapbox.js/v2.2.2/mapbox.js'></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/gsap/1.18.5/TimelineLite.min.js"></script>
  <script>
    var userPosition;

    // getLocation();

    // function getLocation() {
    //     if (navigator.geolocation) {
    //         navigator.geolocation.getCurrentPosition(showPosition);
    //     } else {
    //         console.log("WEFWEF");
    //     }
    // }

    // function showPosition(position) {
    //     userPosition = [position.coords.latitude, position.coords.longitude];
    //     console.log("LAT: " + position.coords.latitude + "LNG: " + position.coords.longitude);
    // }


    // Provide your access token
    L.mapbox.accessToken = 'pk.eyJ1Ijoic2t1bGx5aW5jIiwiYSI6ImNpZXZwZnR2MzB3aWRzdW0ydXZiNTg1MmwifQ.zrm5DHUOGyr0d_6gGw9jjw';
    // Create a map in the div #map
    var map = L.mapbox.map('map', 'skullyinc.cievpftb00whnspm2v0540nii').setView([35.514, -97.383], 4);

    var myLayer = L.mapbox.featureLayer().addTo(map);

    var public_spreadsheet_url = 'https://docs.google.com/spreadsheets/d/1Wn2MOJdTF7NmH29VjqeMcqwLduo6EmL08PxIs93D9x8/pubhtml';

    Tabletop.init({
      key: public_spreadsheet_url,
      callback: buildMap,
      simpleSheet: true
    })

    if (!navigator.geolocation) {
      geolocate.innerHTML = 'Geolocation is not available';
    } else {
      geolocate.onclick = function(e) {
        e.preventDefault();
        e.stopPropagation();
        map.locate();
      };
    }

    // BUILD MAP
    function buildMap(data, tabletop) {
      // console.log(data);

      var geojson = {
        type: 'FeatureCollection',
        features: []
      };

      for (var i = 0; i < data.length; i++) {
        // if (data[i].URL.startsWith("www")) {
        //     data[i].URL = "http://" + data[i].URL;
        // }
        if (!data[i].URL.startsWith("http://") && !data[i].URL.startsWith("https://")) {
            data[i].URL = "http://" + data[i].URL;
        }
        geojson.features.push({
          type: 'Feature',
          properties: {
            title: data[i].DealerName,
            address: data[i].Address,
            'marker-color': '#B22222',
            'marker-size': 'large',
            'marker-symbol': 'star',
            directions: "https://maps.google.com?saddr=Current+Location&daddr=" + data[i].Address.split(' ').join('+'),
            url: data[i].URL
          },
          geometry: {
            type: 'Point',
            coordinates: [parseFloat(data[i].Lng), parseFloat(data[i].Lat)]
          }
        });
      }

      map.on('locationfound', function(e) {
        $("#geolocate").css("display", "none");
        // console.log("locationfound");
        userPosition = [e.latlng.lat, e.latlng.lng];
        geojson.features.push({
          type: 'Feature',
          id: 'location',
          properties: {
            title: "My Location",
            'marker-color': '#989898',
            'marker-size': 'large',
            'marker-symbol': 'star'
          },
          geometry: {
            type: 'Point',
            coordinates: [e.latlng.lng, e.latlng.lat]
          }
        });
        var temp = document.getElementsByClassName("leaflet-marker-icon")
        TweenMax.to(temp[0], 1, {
          onComplete: moveMap
        });
        myLayer.setGeoJSON(geojson);
        myLayer.eachLayer(function(layer) {
          if (layer.feature.id != "location") {
            var content = "<div class='map-tooltip'>" + "<h5 class='text-center bold'>" + layer.feature.properties.title + "</h5>" + "<p>" + layer.feature.properties.address + "</p>" +
              "<a target='_blank' href=https://maps.google.com?saddr=" + e.latlng.lat + "," + e.latlng.lng + "&daddr=" + layer.feature.properties.address.split(' ').join('+') +
              "> Get Directions </a>" + "<br>" + (layer.feature.properties.url ? "<a target='_blank' href=" + layer.feature.properties.url + ">" + "Visit Dealer Website" + "</a>" : "") +
              "</div>";
            layer.bindPopup(content);
          }
        });
        temp = document.getElementsByClassName("leaflet-marker-icon");
        TweenMax.from(temp[temp.length - 1], 1, {
          opacity: 0,
          scale: 0,
          ease: Bounce.easeOut
        });
      });
      myLayer.setGeoJSON(geojson);
      myLayer.eachLayer(function(layer) {
        var content = "<div class='map-tooltip'>" + "<h5 class='text-center bold'>" + layer.feature.properties.title + "</h5>" + "<p>" + layer.feature.properties.address + "</p>" +
          "<a target='_blank' href=" + layer.feature.properties.directions + ">" + "Get Directions" + "</a>" + "<br>" + (layer.feature.properties.url ? "<a target='_blank' href=" + layer.feature.properties
            .url + ">" + "Visit Dealer Website" + "</a>" : "") + "</div>";
        layer.bindPopup(content);
        // console.log(layer.feature.properties.url);
      });
      fade();

    };
    // END BUILD MAP
    // myLayer.on('mouseover', function(e) {
    //     e.layer.openPopup();
    // });
    // myLayer.on('mouseout', function(e) {
    //     e.layer.closePopup();
    // });
    // myLayer.on('click', function(e) {
    //     if (e.layer.feature.properties.url)
    //         window.open(e.layer.feature.properties.url);
    // });
    map.scrollWheelZoom.disable();

    function fade() {
      var temp = document.getElementsByClassName("leaflet-marker-icon")
      // console.log(temp);
      var t1 = new TimelineLite();
      t1.staggerFrom(temp, .5, {
        y: 0,
        ease: Power2.easeIn
      }, .25, null, showbutton);
      // TweenMax.staggerFrom(temp, .5, {opacity: 0, scale: 0, ease:Bounce.easeOut, delay: 1}, .25);

    }

    function showbutton() {
      $('.ui-button').css("display", "block");
    }

    function moveMap() {
      var i = 13;
      var visible = 0;
      var inbounds = [];

      function run() {
        // console.log("Going again at i = " + i + ", Found = " + visible);
        if (i == 13) {
          map.setView(userPosition, i);
        }

        var bounds = map.getBounds();

        myLayer.eachLayer(function(marker) {
          if (bounds.contains(marker.getLatLng())) {
            inbounds.push(marker);
            visible++;
          }
        });
        if (visible < 2) {
          visible = 0;
          i = i - 1;
          map.setView(userPosition, i);
          window.setTimeout(run, 1000);
        } else {
          visible = 0;
          var group = new L.featureGroup(inbounds);
          map.fitBounds(group.getBounds());
        }
      }
      run();
    }
  </script>
  </body>

  </html>
